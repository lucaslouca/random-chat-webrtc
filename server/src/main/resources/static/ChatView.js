import{d as P,r as ne,a as g,l as N,W as oe,o as ie,g as v,A as de,b as ce,c as i,e as d,f as e,h as b,i as x,n as S,u as o,j as c,k as E,t as _,F as B,m as le,w as re,v as ue,p as ve,q as _e,s as pe,x as he,_ as fe}from"./index.js";const p=w=>(_e("data-v-7d4f899f"),w=w(),pe(),w),me={id:"wrapper"},ge={id:"menu"},ye={class:"menu-button-holder"},ke={href:"/",id:"exit"},Ce={id:"disconnect"},be=p(()=>e("canvas",{id:"canvas",style:{display:"none"}},null,-1)),xe={id:"container"},we={id:"video-wrapper"},Ve=p(()=>e("span",null,null,-1)),Ie={"data-peer":"","data-state":"","data-camera":"",id:"video-section"},Me={id:"content"},Se={id:"video-box"},Te=p(()=>e("div",{class:"video",id:"peer-video-box"},[e("video",{id:"peer-video",autoplay:"",playsinline:""}),e("div",{class:"video-placeholder"},"Waiting for peer...")],-1)),De=p(()=>e("div",{class:"video",id:"user-video-box"},[e("video",{id:"user-video",muted:"",autoplay:"",playsinline:""}),e("div",{class:"video-placeholder"},"Attaching to camera...")],-1)),Ne=p(()=>e("input",{id:"audio",type:"checkbox",style:{display:"none"}},null,-1)),Be={id:"video-controls"},Ee=p(()=>e("span",null,null,-1)),Le={class:"control-button"},Pe={key:0,class:"muted"},Ae={key:1},ze={class:"next-button-holder"},Oe={class:"control-button"},je={key:0,class:"muted"},Re={key:1},Ke=p(()=>e("span",null,null,-1)),Ue=p(()=>e("div",{id:"resizer"},[e("span")],-1)),We={id:"sidebar"},Fe={id:"sidebar-content"},$e={class:"chat-container clearfix"},qe={class:"chat"},He={class:"chat-header clearfix"},Je={class:"chat-about"},Ye={key:0,class:"chat-with"},Ge={key:1,class:"chat-num-messages"},Qe={class:"chat-history"},Xe={key:0,class:"loader"},Ze=he('<div class="wrapper" data-v-7d4f899f><div class="circle" data-v-7d4f899f></div><div class="circle" data-v-7d4f899f></div><div class="circle" data-v-7d4f899f></div><div class="shadow" data-v-7d4f899f></div><div class="shadow" data-v-7d4f899f></div><div class="shadow" data-v-7d4f899f></div><span data-v-7d4f899f>Loading...</span></div>',1),et=[Ze],tt={id:"chat-messages"},st={class:"message-data-name"},at={class:"message-data-time"},nt={class:"message-data-time"},ot={class:"message-data-name"},it={key:0},dt={class:"message-data align-right message-data-name"},ct={class:"message-data-name"},lt=p(()=>e("div",{class:"message other-message float-right"},[e("div",{className:"typing"},[e("div",{className:"typing__dot"}),e("div",{className:"typing__dot"}),e("div",{className:"typing__dot"})])],-1)),rt={key:0,class:"chat-message clearfix"},ut={key:2,id:"peer-left"},vt=P({__name:"ChatComp",setup(w){const k=ne([]);let r=g(""),h=g(""),C=g(!1),V=g(!1),I=g(!1),f=g(!1),u=g(!1),m=g(!0),M="rtc-state";const A=N(M);let s=new oe(A.name);s.on("connected",U),s.on("disconnected",W),s.on("peeradded",F),s.on("invite",$),s.on("peerremoved",q),s.on("peerupdated",H),s.on("peerconnected",J),s.on("peerdisconnected",Y),s.on("offer",G),s.on("chat",Q),s.on("typing",X),ie(()=>{j(),O(),y("state","ready");const t=v("#resizer"),a=v("#video-wrapper");t.addEventListener("mousedown",n=>{document.addEventListener("mousemove",l,!1),document.addEventListener("mouseup",()=>{document.removeEventListener("mousemove",l,!1)},!1)});function l(n){const D=a.getBoundingClientRect().left,ae=`${n.x-D}px`;a.style.flexBasis=ae}a.style.flexBasis="70%",console.log("App is ready")});function y(t,a){v("main").setAttribute(`data-${t}`,a)}function z(t){let a=N(M);t.name&&(s.name=t.name);const l={...a,...t};localStorage.setItem(M,JSON.stringify(l))}async function O(){y("camera","attaching");const t=N(M),a=v("#user-video");a.srcObject=null,t.audio?u.value=!0:u.value=!1,t.camera?(a.srcObject=await s.openStream({cameraId:t.camera,audioDisabled:!t.audio}),y("camera","attached"),m.value=!0,setInterval(()=>{L()},5e3)):(m.value=!1,s.closeStream(),y("camera",""))}function j(){v("#disconnect").addEventListener("click",()=>{s.disconnect()})}function R(t){const a=t.target.value;t.key==="Enter"?(s.sendChat(a),f.value=!1,s.sendTyping(!1),T(a,void 0),t.target.value="",h.value=""):a.length===0&&!f.value&&t.key!="Backspace"?(f.value=!0,s.sendTyping(!0)):f.value&&a.length===1&&t.key==="Backspace"&&(f.value=!1,s.sendTyping(!1))}function K(){s.sendChat(h.value),f.value=!1,s.sendTyping(!1),T(h.value,void 0),h.value=""}function U(){console.log("Connected to signal server")}function W(){console.log("Disconnected from signal server")}function F(t){}function $(t){y("peer","connecting"),s==null||s.invite(t.id)}function q(t){s.disconnect()}function H(t){}function J(t){y("peer","connected"),r.value=t.peer.name,C.value=!0,V.value=!1;const a=v("#peer-video");a.srcObject=t.stream}function Y(){const t=v("#peer-video");t.srcObject=null,y("peer",""),C.value=!1,V.value=!0,I.value=!1,f.value=!1}function G(t){s.accept(t)}function Q(t){T(t.message,t.peer)}function X(t){I.value=t.typing}function Z(){var t=new Date,a=t.getHours()+":"+t.getMinutes();return a}function T(t,a){k.push({me:!a,name:a?a.name:"Me",message:t,time:Z()})}function ee(){r.value="",C.value=!1,V.value=!1,I.value=!1,f.value=!1,k.splice(0),s.disconnect(),s.next()}function te(){u.value=!u.value,s.toggleMic(u.value),z({audio:u.value})}function se(){m.value=!m.value,s.toggleVideo(m.value)}function L(){var t="",a=v("canvas"),l=v("#user-video");a.width=200,a.height=200,a.getContext("2d").drawImage(l,0,0,200,200),t=a.toDataURL(),de.getEndpoints("statistics").get("capture")({clientId:s.id,data:t}).then(function(n){console.log("[Chat] Post capture response",n)})}return(t,a)=>{const l=ce("font-awesome-icon");return i(),d("div",me,[e("div",ge,[e("div",ye,[e("a",ke,[e("span",null,[b(l,{icon:"fa-solid fa-xmark"})]),x("Exit")])]),e("button",Ce,[b(l,{icon:"fa-solid fa-xmark"})]),e("button",{onClick:L},"Capture"),be]),e("div",xe,[e("div",we,[Ve,e("main",null,[e("section",Ie,[e("div",Me,[e("div",Se,[Te,De,Ne,e("div",Be,[Ee,e("div",Le,[e("button",{class:"inner",onClick:se},[e("span",{class:S(["video-icon",{disabled:o(m)}])},null,2)]),o(m)?c("",!0):(i(),d("span",Pe,"Video is disabled")),o(m)?(i(),d("span",Ae,"Video is enabled")):c("",!0)]),e("div",ze,[e("button",{class:"next",onClick:ee},[b(l,{icon:"fa-solid fa-rotate"})])]),e("div",Oe,[e("button",{id:"audio-control",class:"inner",onClick:te},[o(u)?(i(),E(l,{key:0,icon:"fa fa-microphone-slash"})):c("",!0),o(u)?c("",!0):(i(),E(l,{key:1,icon:"fa-solid fa-microphone"}))]),o(u)?c("",!0):(i(),d("span",je,"Microphone is disabled")),o(u)?(i(),d("span",Re,"Microphone is enabled")):c("",!0)])]),Ke])])])])]),Ue,e("div",We,[e("section",Fe,[e("div",$e,[e("div",qe,[e("div",He,[e("div",Je,[o(r).length>0?(i(),d("div",Ye," You are chatting with "+_(o(r)),1)):c("",!0),k.length>0?(i(),d("div",Ge," already "+_(k.length)+" messages ",1)):c("",!0)])]),e("div",Qe,[o(r)?c("",!0):(i(),d("div",Xe,et)),e("ul",tt,[(i(!0),d(B,null,le(k,(n,D)=>(i(),d("li",{key:D,class:S({clearfix:!n.me})},[e("div",{class:S(["message-data",{"align-right":!n.me,"message-data-name":!n.me}])},[n.me?(i(),d(B,{key:0},[e("span",st,[b(l,{icon:"fa fa-circle",class:"me"}),x(" "+_(n.name),1)]),e("span",at,_(n.time),1),x("     ")],64)):c("",!0),n.me?c("",!0):(i(),d(B,{key:1},[e("span",nt,_(n.time),1),x("     "),e("span",ot,[x(_(n.name)+" ",1),b(l,{icon:"fa fa-circle",class:"online"})])],64))],2),e("div",{class:S(["message",{"float-right":!n.me,"other-message":!n.me,"my-message":n.me}])},_(n.message),3)],2))),128)),o(I)?(i(),d("li",it,[e("div",dt,[e("span",ct,[x(_(o(r))+" ",1),b(l,{icon:"fa fa-circle",class:"online"})])]),lt])):c("",!0)])]),o(C)||o(V)&&o(r)?(i(),d("div",rt,[o(C)?re((i(),d("input",{key:0,name:"message-to-send",id:"chat-input",placeholder:"Type your message",onKeydown:R,"onUpdate:modelValue":a[0]||(a[0]=n=>ve(h)?h.value=n:h=n)},null,544)),[[ue,o(h)]]):c("",!0),o(C)?(i(),d("button",{key:1,id:"chat-button",onClick:K},"Send")):c("",!0),o(V)&&o(r)?(i(),d("span",ut,_(o(r))+" left the chat",1)):c("",!0)])):c("",!0)])])])])])])}}});const _t=fe(vt,[["__scopeId","data-v-7d4f899f"]]),ht=P({__name:"ChatView",setup(w){return(k,r)=>(i(),E(_t))}});export{ht as default};
